{% extends '../template/adm.phtml' %}
{% block content %}
<div class="container bs-docs-container">
    <div class="row">
        <div class="col-md-3 ">
            <div class="bs-sidebar hidden-print"  data-spy="affix" data-offset-bottom="180" role="complementary">
                <ul class="nav bs-sidenav">
                    <li>
                        <a href="{{ url('report/index') }}" class="list-group-item" ><span class="menu-icon glyphicon glyphicon-play"></span>Inicio</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-md-9" role="main">
            <p>{{ _session.getMessage() }}</ p>
            <div class="well">
                <fieldset>
                    <legend>Relatório</legend>
                    <div class="col-lg-10 col-lg-offset-1">
                        <form class="form-horizontal" action="#" method="get">
                            <div class="form-group">
                                <label for="report_selection">Selecione o relatório</label>
                                <select name="report_selection" id="report_selection" class="form-control">
                                    <option value="" selected="selected">---Selecione---</option>
                                    <option value="1">Usuários</option>
                                    <option value="2">Atividades</option>
                                    <option value="3">Tipos de atividade</option>
                                    <option value="4">Ponto</option>
                                    <option value="5">Atividades Dia</option>
                                </select>
                            </div>
                        </form>
                    </div>
                </fieldset>
                <div id="paramsPanel" style="display: none;">
                    <fieldset>
                        <legend>Filtros</legend>
                        <div class="col-lg-10 col-lg-offset-1">
                            <form action="#" id="paramsForm" method="get" class="form-inline">
                                <div class="row">
                                    <div class="form-group col-lg-6 col-md-6 col-xs-12 col-sm-6">
                                        <label class="control-label">Data inicial</label>
                                        <div class="input-date input-group date" data-date-format="dd/mm/yy" data-date="{{ date('d/m/y') }}">
                                            <span class="input-group-btn add-on">
                                                <button class="btn btn-primary">
                                                    <span class="glyphicon glyphicon-calendar icon-calendar"></span>
                                                </button>
                                            </span>
                                            <input type="text" class="form-control" name="startDate" value="{{ date('d/m/y') }}"  />
                                        </div>
                                    </div>
                                    <div class=" col-lg-6 col-md-6 col-xs-12 col-sm-6">
                                        <label class="control-label">Data final</label>
                                        <div class="input-date input-group date" data-date-format="dd/mm/yy" data-date="{{ date('d/m/y') }}">
                                            <span class="input-group-btn add-on">
                                                <button class="btn btn-primary">
                                                    <span class="glyphicon glyphicon-calendar icon-calendar"></span>
                                                </button>
                                            </span>
                                            <input type="text" class="form-control" name="endDate" value="{{ date('d/m/y') }}"  />
                                        </div>
                                    </div>
                                </div>
                                <div class="row" id="user" style="margin: 10px 0px;">
                                    <div class="">
                                        <label>Usuário <span class="text-danger">*</span></label>
                                        <select name="user_id" id="user_id" class="form-control"  style="width: 100%">
                                            <option value="">---Selecione---</option>
                                            {% for u in users %}
                                            <option value="{{u.getId()}}">{{u.getName()}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="row" id="customer" style="margin: 10px 0px;">
                                    <div class="">
                                        <label>Cliente</label>
                                        <select name="customer_id" id="customer_id" class="form-control"  style="width: 100%">
                                            <option value="">---Selecione---</option>
                                            {% for c in customers %}
                                            <option value="{{c.getId()}}">{{c.getName()}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="row" id="type" style="margin: 10px 0px;">
                                    <div class="">
                                        <label>Tipo de atividade</label>
                                        <select name="type_id" id="type_id" class="form-control"  style="width: 100%">
                                            <option value="">---Selecione---</option>
                                            {% for t in types %}
                                            <option value="{{t.getId()}}">{{t.getName()}}</option>
                                            {% endfor %}
                                        </select>
                                    </div>
                                </div>
                                <div class="row">
                                    <div class="" style="margin-top: 20px">
                                        <button class="btn btn-primary pull-right" type="submit"><span class="menu-icon glyphicon glyphicon-search"></span></button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </fieldset>
                </div>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $('#report_selection').change(function() {
        var newval = $('#report_selection').val();
        $('div#user').css('display', 'none');
        $('div#user').find('span.text-danger').css('display', 'inline');
        $('div#customer').css('display', 'none');
        $('div#type').css('display', 'none');
        if (newval === '') {
            $('#paramsPanel').slideUp();
        } else {
            $('#paramsPanel').slideDown();
            if (newval === '1') { // Users
                $('#paramsForm').attr('action', '{{ url("report/user")}}');
            } else if (newval === '2') { // Activity
                $('#paramsForm').attr('action', '{{ url("report/activity")}}');
            } else if (newval === '3') { // Activity type
                $('#paramsForm').attr('action', '{{ url("report/type")}}');

                $('div#user').css('display', 'block');
                $('div#customer').css('display', 'block');
                $('div#type').css('display', 'block');
                $('div#user').find('span.text-danger').css('display', 'none');
            } else if (newval === '4') { // Work
                $('#paramsForm').attr('action', '{{ url("report/work")}}');
                $('div#user').css('display', 'block');
            } else if (newval === '5') { // Activity by day
                $('#paramsForm').attr('action', '{{ url("report/work_detail")}}');
                $('div#user').css('display', 'block');
            }
        }
    });

    $('#paramsForm').submit(function() {

        var newval = $('#report_selection').val();
        var user = $('div#user');

        if (user.is(':visible') && newval !== '3') {
            try {
                if (user.find('option:selected').val() === "") {
                    alert("Selecione um usuário!");
                    return false;
                }
            } catch (e) {
                return false;
            }
            return true;
        }

    });
</script>
{% endblock %}