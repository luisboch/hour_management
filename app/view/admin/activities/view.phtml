{% extends '../template/adm.phtml' %}
{% block content %}
<div class="container bs-docs-container">
    <div class="row">
        <div class="col-md-3 ">
            <div class="bs-sidebar hidden-print"  data-spy="affix" data-offset-bottom="180" role="complementary">
                <ul class="nav bs-sidenav">
                    <li>
                        <a href="{{ url('activities') }}" class="list-group-item" ><span class="menu-icon glyphicon glyphicon-play"></span>Inicio</a>
                        <a href="{{ url('activities/new') }}" class="list-group-item" ><span class="menu-icon glyphicon glyphicon-edit"></span>Novo</a>
                        <a href="{{ url('activities/search') }}" class="list-group-item" ><span class="menu-icon glyphicon glyphicon-search"></span>Pesquisar</a>
                    </li>
                </ul>
            </div>
        </div>
        <div class="col-md-9" role="main">
            <p>{{ _session.getMessage() }}</ p>
            <div class="well">
                <fieldset >
                    <legend>Atividades | Dados</legend>
                    <form action="{{ url('activities/save/') }}" method="post" >


                        <input type="hidden" name="id" value="{{instance.getId()}}">
                        <div class="form-group">
                            <label for="name" >Nome</label>
                            <input type="text" class="form-control" name="name" required placeholder="Nome da Atividade" value="{{instance.getName()}}"/>
                        </div>
                        <div class="form-group">
                            <label for="email" >Descrição</label>
                            <textarea class="form-control" name="description" required >{{instance.getDescription()}}</textarea>
                        </div>
                        <div>
                            <div class="form-group">
                                <label for="cpf" >Prioridade</label>
                                <input type="number" max="100" min="0" class="form-control" name="priority" required value="{{instance.getPriority()}}"/>
                            </div>
                            <div class="form-group">
                                <label for="cpf" >Tipo de Atividade</label>
                                <select class="form-control" name="type">
                                    <option value="">---Selecione---</option>
                                    {% for t in types %}
                                    <option value="{{t.getId()}}" {{ t.equals(instance.getActivityType()) ? 'selected':'' }} >{{t.getName()}}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="user" >Responsável</label>
                                <select class="form-control" name="user">
                                    <option value="">---Selecione---</option>
                                    {% for t in users %}
                                    <option value="{{t.getId()}}" {{ t.equals(instance.getUser()) ? 'selected':'' }} >{{t.getName()}}</option>
                                    {% endfor %}
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="status" >Status</label>
                                <select class="form-control" name="status" id="status">
                                    <option value="">---Selecione---</option>
                                    <option value="0" {{ 0 == instance.getStatus() ? 'selected':'' }} >Aberto</option>
                                    <option value="1" {{ 1 == instance.getStatus() ? 'selected':'' }} >Finalizado</option>
                                </select>
                            </div>
                            {% if (instance.getId() != null) %}
                            {% if count(instance.getInteractions()) > 0 %} 
                            <fieldset >
                                <legend>Ações</legend>
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th class="col-lg-5 col-xs-5">Usuário</th>
                                            <th class="col-lg-3 col-xs-3">Inicio</th>
                                            <th class="col-lg-3 col-xs-3">Fim</th>
                                            <th class="col-lg-1 col-xs-1"></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for a in instance.getInteractions() %}
                                        <tr>
                                            <td>{{a.getUser().getName()}}</td>
                                            <td>{{formatDate(a.getStartDate())}}</td>
                                            {% if a.getEndDate() == null %}
                                            <td>
                                                <a href="{{ url('activities/finish/'~ instance.getId() ~ '/' ~ a.getId()) }}">
                                                    <span class=" glyphicon glyphicon-thumbs-up" title="Concluir ação"></span>
                                                </a>
                                            </td>
                                            {% endif %}
                                            {% if a.getEndDate() != null %}
                                            <td>{{formatDate(a.getEndDate())}}</td>
                                            {% endif %}
                                            <td><a href="{{ url('activities/remove/'~ instance.getId() ~ '/' ~ a.getId()) }}" onclick="return confirm('Deseja realmente remover esta ação?')"><span class=" glyphicon glyphicon-ban-circle"></span></a></td>

                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </fieldset>
                            {% endif %}
                            <fieldset class="form-inline">
                                <legend>Incluir Tempo</legend>
                                <div class="form-group col-lg-4 col-md-4">
                                    <label class="control-label">Data</label>
                                    <div class="input-date input-group date" data-date-format="dd/mm/yy" data-date="{{ date('d/m/y') }}">
                                        <span class="input-group-btn add-on">
                                            <button class="btn btn-primary">
                                                <span class="glyphicon glyphicon-calendar icon-calendar"></span>
                                            </button>
                                        </span>
                                        <input type="text" class="form-control" name="action_date" value="{{ date('d/m/y') }}"  />
                                    </div>
                                </div>
                                <div class="form-group  col-lg-4 col-md-4">
                                    <label for="action_time" >
                                        <span>Inicio</span>
                                    </label>
                                    <input type="time" class="form-control" name="action_start_time" id="action_start_time"/>
                                </div>
                                <div class="form-group col-lg-4 col-md-4">
                                    <label for="action_time" >
                                        <span>Fim</span>
                                    </label>
                                    <input type="time" class="form-control" name="action_end_time" id="action_end_time"/>
                                </div>
                            </fieldset>
                            {% endif %}
                            <div class="form-group col-lg-offset-11">
                                <div class="checkbox">
                                    <label>
                                        <input type="checkbox" name="active" {{instance.getActive()?'checked="checked"':''}} />Ativo?
                                    </label>
                                </div>
                            </div>
                            <div class="form-group text-right" >
                                <a class="btn btn-danger" href="{{url('activities')}}"  >Cancelar<span class="menu-icon glyphicon glyphicon-ban-circle"></span></a>
                                <button type="submit" class="btn btn-success"  >Salvar<span class="menu-icon glyphicon glyphicon-ok"></span></button>
                            </div>
                    </form>
                </fieldset>
            </div>
        </div>
    </div>
</div>
<script type="text/javascript">
    $('#action_end_time').timepicker({'timeFormat': 'H:i:s'});
    $('#action_start_time').timepicker({'timeFormat': 'H:i:s'});
    $('#status').change(function() {
        var newval = $('#status').val();
        if (newval === '') {
            $('#newActionPanel').slideUp();
            $('input[name=action_start_time]').val('');
            $('input[name=action_end_time]').val('');
        } else {
            if (newval === '0') {
                $('#newActionPanel').slideDown();
            } else if (newval === '1') {
                $('input[name=action_start_time]').val('');
                $('input[name=action_end_time]').val('');
                $('#newActionPanel').slideUp();
            }
        }
    });
</script>
{% endblock %}
